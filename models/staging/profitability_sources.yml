# This file defines the raw data sources used for the profitability analysis.
# It specifies the metadata and data quality tests for:
# 1. `bureau_of_labor_statistics_price_timeseries`: Time-series data for product prices.
# 2. `bureau_of_labor_statistics_price_attributes`: Product attributes (e.g., product name, frequency).

# Purpose:
# - Document raw data sources used in the staging layer.
# - Define data quality tests to ensure consistency and reliability.

# Key Features:
# - `source`: Specifies the database and schema for each raw table.
# - `tables`: Lists the tables and their column-level metadata.
# - Data quality tests:
#   - `not_null`: Ensures critical fields are never null.
#   - `accepted_values`: Validates categorical fields (e.g., frequency values).
#   - `relationships`: Ensures relationships between tables (e.g., `variable` matches across tables).

# Downstream Usage:
# - Provides input data for the `stg_profitability_timeseries` staging model.
# - Ensures raw data quality before transformations.

version: 2

sources:
  - name: pricing
    database: finance
    schema: cybersyn
    tables:  
      - name: bureau_of_labor_statistics_price_timeseries
        columns:
          - name: date
            tests:
              - not_null
          - name: geo_id
            tests:
              - unique
              - not_null
          - name: value
            tests:
              - not_null:
                  where: "value is not null"
          - name: variable
            tests:
              - relationships:
                  to: source('pricing', 'bureau_of_labor_statistics_price_attributes')
                  field: variable  
          - name: variable_name
            tests:
              - not_null
      - name: bureau_of_labor_statistics_price_attributes
        columns:
          - name: variable
            tests:
              - unique
              - not_null
          - name: product
            tests:
              - not_null
          - name: seasonally_adjusted
            tests:
              - accepted_values:
                  values: ['true','false']
                  
          - name: frequency
            tests:
              - accepted_values:
                  values: ['Monthly', 'Semi-annual', 'Annual']
          - name: unit
            tests:
              - not_null
